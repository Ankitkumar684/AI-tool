<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free online tool to compress your images while maintaining quality. Reduce file size for JPG, PNG, and WebP images.">
    <title>Ankit AI tool | Reduce Image Size Online</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --success: #4bb543;
            --border-radius: 8px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: #f5f7ff;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 24px;
            height: 24px;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        nav a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            padding: 8px 12px;
            border-radius: var(--border-radius);
        }

        nav a:hover {
            color: var(--primary);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .hero {
            text-align: center;
            padding: 60px 0 40px;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 16px;
            color: var(--dark);
            font-weight: 700;
        }

        .hero p {
            font-size: 1.1rem;
            color: var(--gray);
            max-width: 700px;
            margin: 0 auto 30px;
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 30px;
        }

        .card-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .card-header h2 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.8rem;
        }

        .card-header p {
            color: var(--gray);
        }

        .drop-area {
            border: 2px dashed var(--light-gray);
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
            background-color: rgba(248, 249, 250, 0.5);
            position: relative;
        }

        .drop-area:hover {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.05);
        }

        .drop-area.highlight {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .drop-area-icon {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .drop-area p {
            margin-bottom: 15px;
            color: var(--gray);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background-color: var(--primary);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            text-decoration: none;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background-color: rgba(67, 97, 238, 0.1);
            transform: none;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            background-color: #3fa138;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .control-group label .info-icon {
            color: var(--gray);
            cursor: help;
        }

        select, input[type="range"], input[type="number"], input[type="text"] {
            padding: 12px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            width: 100%;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        input[type="range"] {
            padding: 0;
            -webkit-appearance: none;
            height: 8px;
            background: var(--light-gray);
            border-radius: 4px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .file-size-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-size-control input {
            flex: 1;
        }

        .file-size-control select {
            width: 80px;
        }

        .preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .image-preview {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            text-align: center;
        }

        .image-preview h3 {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 1.2rem;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            object-fit: contain;
        }

        .file-info {
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--gray);
            display: flex;
            justify-content: space-between;
        }

        .file-info span {
            font-weight: 500;
            color: var(--dark);
        }

        .results {
            margin-top: 30px;
            text-align: center;
        }

        .results p {
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .savings {
            font-weight: 600;
            color: var(--success);
        }

        .spinner {
            display: none;
            width: 40px;
            height: 40px;
            margin: 20px auto;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-container {
            width: 100%;
            background-color: var(--light-gray);
            border-radius: 4px;
            margin: 20px 0;
            display: none;
            height: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .info-section {
            margin: 40px 0;
        }

        .info-section h2 {
            margin-bottom: 15px;
            color: var(--dark);
        }

        .info-section p, .info-section ul, .info-section ol {
            margin-bottom: 15px;
            color: var(--gray);
        }

        .info-section ul, .info-section ol {
            padding-left: 20px;
        }

        .info-section li {
            margin-bottom: 8px;
        }

        footer {
            background-color: var(--dark);
            color: white;
            padding: 40px 0 20px;
            margin-top: 60px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-section h3 {
            margin-bottom: 15px;
            color: white;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section li {
            margin-bottom: 8px;
        }

        .footer-section a {
            color: #adb5bd;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-section a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #495057;
            color: #adb5bd;
            font-size: 0.9rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            nav ul {
                gap: 10px;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .hero p {
                font-size: 1rem;
            }

            .card-header h2 {
                font-size: 1.5rem;
            }

            .controls {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .hero {
                padding: 40px 0 30px;
            }

            .hero h1 {
                font-size: 1.8rem;
            }

            .card {
                padding: 20px;
            }

            .drop-area {
                padding: 30px 15px;
            }

            .btn {
                padding: 10px 20px;
                width: 100%;
            }

            .preview-container {
                grid-template-columns: 1fr;
            }
        }

        /* Toggle switch for MB/KB */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 10px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .toggle-labels {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            width: 100%;
            text-align: center;
            pointer-events: none;
        }

        .toggle-labels span {
            position: absolute;
            transition: opacity 0.2s;
        }

        .toggle-labels span:first-child {
            left: 6px;
            opacity: 1;
        }

        .toggle-labels span:last-child {
            right: 6px;
            opacity: 0;
        }

        input:checked ~ .toggle-labels span:first-child {
            opacity: 0;
        }

        input:checked ~ .toggle-labels span:last-child {
            opacity: 1;
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <a href="/" class="logo">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 16L8.586 11.414C8.961 11.039 9.47 10.828 10 10.828C10.53 10.828 11.039 11.039 11.414 11.414L16 16M14 14L15.586 12.414C15.961 12.039 16.47 11.828 17 11.828C17.53 11.828 18.039 12.039 18.414 12.414L20 14M14 8H14.01M6 20H18C19.105 20 20 19.105 20 18V6C20 4.895 19.105 4 18 4H6C4.895 4 4 4.895 4 6V18C4 19.105 4.895 20 6 20Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                ImageCompressor
            </a>
            <nav>
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/features">Features</a></li>
                    <li><a href="/blog">Blog</a></li>
                    <li><a href="/contact">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h1>Optimize Your Images in Seconds</h1>
            <p>Reduce image file size without losing quality. Perfect for websites, social media, and email attachments.</p>
        </section>

        <div class="card">
            <div class="card-header">
                <h2>Image Compression Tool</h2>
                <p>Upload your image and adjust settings for optimal results</p>
            </div>

            <div id="dropArea" class="drop-area">
                <div class="drop-area-icon">
                    <svg viewBox="0 0 24 24" width="48" height="48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7 16C4.791 16 3 14.209 3 12C3 9.791 4.791 8 7 8C7.933 8 8.8 8.334 9.5 8.9L10 9.333V4H14V9.333L14.5 8.9C15.2 8.334 16.067 8 17 8C19.209 8 21 9.791 21 12C21 14.209 19.209 16 17 16M12 12V20M9 17L12 20L15 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <p>Drag & drop your image here or</p>
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
                <button id="selectFilesBtn" class="btn">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Select Image
                </button>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="formatSelect">
                        Output Format
                        <span class="info-icon" title="Choose the file format for your compressed image">ⓘ</span>
                    </label>
                    <select id="formatSelect">
                        <option value="original">Original Format</option>
                        <option value="jpeg">JPEG (Best for photos)</option>
                        <option value="png">PNG (Best for transparency)</option>
                        <option value="webp">WebP (Modern format)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="qualityRange">Quality: <span id="qualityValue">80</span>%</label>
                    <input type="range" id="qualityRange" min="1" max="100" value="80">
                    <div class="range-labels">
                        <span>Smaller</span>
                        <span>Larger</span>
                    </div>
                </div>

                <div class="control-group">
                    <label for="targetSize">Target Size</label>
                    <div class="file-size-control">
                        <input type="number" id="targetSize" min="1" value="500">
                        <select id="sizeUnit">
                            <option value="KB">KB</option>
                            <option value="MB">MB</option>
                        </select>
                        <label class="toggle-switch">
                            <input type="checkbox" id="sizeToggle">
                            <span class="slider"></span>
                            <span class="toggle-labels">
                                <span>KB</span>
                                <span>MB</span>
                            </span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div class="spinner" id="spinner"></div>

            <button id="compressBtn" class="btn" style="display: none; width: 100%;">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px;">
                    <path d="M19 14C19.34 14 19.67 14.04 20 14.09V8C20 6.9 19.1 6 18 6H12L10 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H14.09C14.04 19.67 14 19.34 14 19C14 16.24 16.24 14 19 14ZM17 12V9H15V12H12V14H15V17H17V14H20V12H17Z" fill="currentColor"/>
                </svg>
                Compress Image
            </button>

            <div class="preview-container" id="previewContainer" style="display: none;">
                <div class="image-preview">
                    <h3>Original Image</h3>
                    <img id="originalPreview" src="" alt="Original image preview">
                    <div class="file-info">
                        <span>File name:</span> <span id="originalName"></span>
                    </div>
                    <div class="file-info">
                        <span>File size:</span> <span id="originalSize"></span>
                    </div>
                    <div class="file-info">
                        <span>Dimensions:</span> <span id="originalDimensions"></span>
                    </div>
                </div>
                <div class="image-preview">
                    <h3>Compressed Image</h3>
                    <img id="compressedPreview" src="" alt="Compressed image preview">
                    <div class="file-info">
                        <span>File name:</span> <span id="compressedName"></span>
                    </div>
                    <div class="file-info">
                        <span>File size:</span> <span id="compressedSize"></span>
                    </div>
                    <div class="file-info">
                        <span>Dimensions:</span> <span id="compressedDimensions"></span>
                    </div>
                </div>
            </div>

            <div class="results" id="results" style="display: none;">
                <p>Compression complete! <span class="savings" id="savingsText"></span></p>
                <button id="downloadBtn" class="btn btn-success">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px;">
                        <path d="M12 15V3M12 15L8 11M12 15L16 11M2 17V18C2 19.105 2.895 20 4 20H20C21.105 20 22 19.105 22 18V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Download Compressed Image
                </button>
            </div>
        </div>

        <section class="info-section">
            <h2>How to Use This Image Compressor</h2>
            <ol>
                <li><strong>Upload your image</strong> - Drag and drop or click to select from your device</li>
                <li><strong>Choose output format</strong> - Select JPEG, PNG, WebP, or keep original format</li>
                <li><strong>Adjust quality</strong> - Slide to find the perfect balance between size and quality</li>
                <li><strong>Set target size</strong> - Optionally specify a target file size in KB or MB</li>
                <li><strong>Click "Compress Image"</strong> - Wait a moment while we optimize your image</li>
                <li><strong>Download the result</strong> - Get your compressed image with reduced file size</li>
            </ol>

            <h2>Why Compress Images?</h2>
            <p>Image optimization is crucial for:</p>
            <ul>
                <li><strong>Faster websites</strong> - Smaller images load quicker, improving user experience</li>
                <li><strong>Better SEO</strong> - Page speed is a ranking factor for search engines</li>
                <li><strong>Reduced bandwidth</strong> - Save on hosting costs and data transfers</li>
                <li><strong>Social media</strong> - Platforms often compress images automatically with poor results</li>
                <li><strong>Email attachments</strong> - Many services have strict size limits for attachments</li>
            </ul>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>ImageCompressor</h3>
                    <p>Free online tools to optimize your images for web and mobile.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="/privacy">Privacy Policy</a></li>
                        <li><a href="/terms">Terms of Service</a></li>
                        <li><a href="/contact">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Tools</h3>
                    <ul>
                        <li><a href="/image-compressor">Image Compressor</a></li>
                        <li><a href="/image-converter">Image Converter</a></li>
                        <li><a href="/image-resizer">Image Resizer</a></li>
                        <li><a href="/image-optimizer">Image Optimizer</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; <span id="currentYear"></span> ImageCompressor. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Current year for copyright
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        // DOM elements
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('fileInput');
        const selectFilesBtn = document.getElementById('selectFilesBtn');
        const compressBtn = document.getElementById('compressBtn');
        const formatSelect = document.getElementById('formatSelect');
        const qualityRange = document.getElementById('qualityRange');
        const qualityValue = document.getElementById('qualityValue');
        const targetSizeInput = document.getElementById('targetSize');
        const sizeUnitSelect = document.getElementById('sizeUnit');
        const sizeToggle = document.getElementById('sizeToggle');
        const previewContainer = document.getElementById('previewContainer');
        const originalPreview = document.getElementById('originalPreview');
        const compressedPreview = document.getElementById('compressedPreview');
        const originalName = document.getElementById('originalName');
        const originalSize = document.getElementById('originalSize');
        const originalDimensions = document.getElementById('originalDimensions');
        const compressedName = document.getElementById('compressedName');
        const compressedSize = document.getElementById('compressedSize');
        const compressedDimensions = document.getElementById('compressedDimensions');
        const results = document.getElementById('results');
        const savingsText = document.getElementById('savingsText');
        const downloadBtn = document.getElementById('downloadBtn');
        const spinner = document.getElementById('spinner');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        
        // Variables
        let selectedFile = null;
        let compressedFile = null;
        let originalWidth = 0;
        let originalHeight = 0;
        
        // Event listeners
        selectFilesBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFiles);
        
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.classList.add('highlight');
        });
        
        dropArea.addEventListener('dragleave', () => {
            dropArea.classList.remove('highlight');
        });
        
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.classList.remove('highlight');
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFiles({ target: fileInput });
            }
        });
        
        qualityRange.addEventListener('input', () => {
            qualityValue.textContent = qualityRange.value;
        });
        
        sizeToggle.addEventListener('change', () => {
            if (sizeToggle.checked) {
                sizeUnitSelect.value = 'MB';
            } else {
                sizeUnitSelect.value = 'KB';
            }
        });
        
        sizeUnitSelect.addEventListener('change', () => {
            sizeToggle.checked = sizeUnitSelect.value === 'MB';
        });
        
        compressBtn.addEventListener('click', compressImage);
        downloadBtn.addEventListener('click', downloadImage);
        
        // Functions
        function handleFiles(e) {
            const files = e.target.files;
            if (!files.length) return;
            
            // For simplicity, we'll process the first file only
            selectedFile = files[0];
            
            // Validate file type
            if (!selectedFile.type.match('image.*')) {
                alert('Please select an image file (JPEG, PNG, etc.)');
                return;
            }
            
            // Display original image
            const reader = new FileReader();
            reader.onload = (e) => {
                originalPreview.src = e.target.result;
                
                // Get image dimensions
                const img = new Image();
                img.onload = function() {
                    originalWidth = this.width;
                    originalHeight = this.height;
                    originalDimensions.textContent = `${originalWidth} × ${originalHeight} px`;
                    
                    // Update file info
                    originalName.textContent = selectedFile.name;
                    originalSize.textContent = formatBytes(selectedFile.size);
                    
                    previewContainer.style.display = 'grid';
                    compressBtn.style.display = 'block';
                    results.style.display = 'none';
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(selectedFile);
        }
        
        function compressImage() {
            if (!selectedFile) return;
            
            // Show loading state
            spinner.style.display = 'block';
            progressContainer.style.display = 'block';
            compressBtn.disabled = true;
            
            // Get target size in bytes
            let targetSizeBytes = parseInt(targetSizeInput.value);
            if (sizeUnitSelect.value === 'MB') {
                targetSizeBytes *= 1024 * 1024;
            } else {
                targetSizeBytes *= 1024;
            }
            
            // Simulate compression progress (in a real app, this would be actual compression)
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 5;
                progressBar.style.width = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    onCompressionComplete();
                }
            }, 100);
            
            // In a real implementation, you would:
            // 1. Create a canvas element
            // 2. Draw the image on the canvas with the specified dimensions
            // 3. Convert the canvas to the desired format with the specified quality
            // 4. Create a blob from the canvas and generate a download URL
            // 5. Adjust quality iteratively to match target size if specified
            
            // For this demo, we'll simulate the result after a delay
            function onCompressionComplete() {
                spinner.style.display = 'none';
                compressBtn.disabled = false;
                
                // Simulate compressed file (in a real app, this would be the actual compressed image)
                const originalSizeBytes = selectedFile.size;
                const quality = parseInt(qualityRange.value) / 100;
                
                // If target size is specified, adjust quality to match
                let simulatedSize;
                if (targetSizeInput.value && !isNaN(targetSizeInput.value)) {
                    // Simulate getting close to target size
                    simulatedSize = Math.min(
                        Math.max(originalSizeBytes * quality * 0.7, originalSizeBytes * 0.1), // At least 10% of original
                        targetSizeBytes * 0.95 // Get close to target but not exact for demo
                    );
                } else {
                    simulatedSize = Math.max(originalSizeBytes * quality * 0.7, originalSizeBytes * 0.1);
                }
                
                compressedFile = {
                    name: getOutputFilename(),
                    size: simulatedSize,
                    dataUrl: originalPreview.src, // In real app, this would be the compressed data URL
                    width: originalWidth,
                    height: originalHeight
                };
                
                // Display results
                compressedPreview.src = compressedFile.dataUrl;
                compressedName.textContent = compressedFile.name;
                compressedSize.textContent = formatBytes(compressedFile.size);
                compressedDimensions.textContent = `${compressedFile.width} × ${compressedFile.height} px`;
                
                const savings = originalSizeBytes - simulatedSize;
                const percent = (savings / originalSizeBytes * 100).toFixed(1);
                savingsText.textContent = `Reduced by ${formatBytes(savings)} (${percent}% savings)`;
                
                results.style.display = 'block';
                
                // Scroll to results
                results.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
        
        function downloadImage() {
            if (!compressedFile) return;
            
            // In a real app, you would use the actual compressed blob
            const a = document.createElement('a');
            a.href = compressedFile.dataUrl;
            a.download = compressedFile.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
        
        function getOutputFilename() {
            const originalName = selectedFile.name;
            const dotIndex = originalName.lastIndexOf('.');
            const nameWithoutExt = dotIndex > 0 ? originalName.substring(0, dotIndex) : originalName;
            const originalExt = dotIndex > 0 ? originalName.substring(dotIndex + 1).toLowerCase() : '';
            
            let newExt = originalExt;
            switch (formatSelect.value) {
                case 'jpeg': newExt = 'jpg'; break;
                case 'png': newExt = 'png'; break;
                case 'webp': newExt = 'webp'; break;
                // For 'original', keep the original extension
            }
            
            return `${nameWithoutExt}-compressed.${newExt}`;
        }
        
        function formatBytes(bytes, decimals = 1) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
